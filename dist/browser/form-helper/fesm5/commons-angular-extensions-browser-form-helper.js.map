{"version":3,"file":"commons-angular-extensions-browser-form-helper.js","sources":["ng://@co.mmons/angular-extensions/browser/form-helper/form-helper.ts","ng://@co.mmons/angular-extensions/browser/form-helper/commons-angular-extensions-browser-form-helper.ts"],"sourcesContent":["import {NgModule, Directive, ContentChildren, QueryList, ElementRef, Input, Optional} from \"@angular/core\";\nimport {FormGroup, FormControlName, FormGroupDirective, NgForm, CheckboxControlValueAccessor, AbstractControl} from \"@angular/forms\";\n\n@Directive({\n    selector: \"[ngx-form-helper],[ngxFormHelper]\",\n    exportAs: \"ngxFormHelper\"\n})\nexport class FormHelper {\n\n    constructor(public readonly element: ElementRef<HTMLElement>, @Optional() public readonly ngForm: NgForm, @Optional() private readonly formGroupDirective: FormGroupDirective) {\n    }\n\n    @Input()\n    public get readonly(): boolean {\n        return this.element.nativeElement.hasAttribute(\"readonly\");\n    }\n\n    public set readonly(readonly: boolean) {\n        if (readonly) {\n            this.element.nativeElement.setAttribute(\"readonly\", \"\");\n        } else {\n            this.element.nativeElement.removeAttribute(\"readonly\");\n        }\n    }\n\n    public markAsReadonly() {\n        this.readonly = true;\n    }\n\n    @Input()\n    public get busy(): boolean {\n        return this.element.nativeElement.hasAttribute(\"busy\");\n    }\n\n    public set busy(busy: boolean) {\n        if (busy) {\n            this.element.nativeElement.setAttribute(\"busy\", \"\");\n        } else {\n            this.element.nativeElement.removeAttribute(\"busy\");\n        }\n    }\n\n    public markAsBusy() {\n        this.busy = true;\n    }\n\n    @ContentChildren(FormControlName, {descendants: true})\n    protected readonly contentControls: QueryList<FormControlName>;\n\n    public formControlName(name: string): FormControlName {\n\n        for (let a of this.contentControls.toArray()) {\n            if (a.name == name) {\n                return a;\n            }\n        }\n    }\n\n    public get formGroup(): FormGroup {\n        return this.formGroupDirective ? this.formGroupDirective.form : undefined;\n    }\n\n    public validateAll(markAs: \"touched\" | \"dirty\" = \"touched\") {\n\n        if (!this.formGroupDirective) {\n            return;\n        }\n\n        for (let controlName in this.formGroup.controls) {\n            let control = this.formGroup.controls[controlName];\n\n            if (markAs == \"touched\") {\n                control.markAsTouched();\n            }\n\n            if (markAs == \"dirty\") {\n                control.markAsDirty();\n            }\n\n            control.updateValueAndValidity();\n        }\n        \n        for (let control of this.contentControls.toArray()) {\n            if (!control.valid) {\n                this.focusImpl(control);\n                break;\n            }\n        }\n    }\n\n    private focusImpl(control: string | any, scrollIntoView: boolean = true) {\n\n        if (typeof control == \"string\" && this.formGroupDirective) {\n            for (let c of this.formGroupDirective.directives) {\n                if (c.name == control) {\n                    control = c;\n                    break;\n                }\n            }\n        }\n\n        let elementToScroll: HTMLElement;\n\n        if (control instanceof FormControlName) {\n            let element: HTMLElement = this.element.nativeElement.querySelector(\"[formcontrolname=\" + control.name + \"]\");\n            if (element) {\n                elementToScroll = element;\n                element.focus();\n            }\n        }\n\n        // if (\"setFocus\" in control) {\n        //     control.setFocus();\n        //     elementToScroll = control.getNativeElement().closest(\".item\");\n        // } else if (control && typeof control.focus == \"function\") {\n        //     control.focus();\n        // }\n\n        // if (!elementToScroll && control && control.nativeElement) {\n        //     elementToScroll = control.nativeElement.closest(\".item\") || control.nativeElement;\n        // }\n\n        if (scrollIntoView && elementToScroll) {\n            elementToScroll.scrollIntoView();\n        }\n    }\n\n    public focus(formControlName: string, scrollIntoView: boolean = true) {\n        this.focusImpl(formControlName, scrollIntoView);\n    }\n}\n\n@NgModule({\n    declarations: [FormHelper],\n    bootstrap: [],\n    exports: [FormHelper]\n})\nexport class FormHelperModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}